This README covers how to install the Schlumberger smart card reader,
install a user certificate on it and use that certificate to authenticate
to secured Cougaar Servlets. It also covers how to install the keystore
password applet on Linux servers.

SMART CARD BROWSER SUPPORT
==========================

1) Install the Schlumberger software from the driver CD onto your
   Windows machine. If you are using Windows NT, you will not be able
   to use the USB Schlumberger smart card reader. Find a Windows 2000,
   XP, 98, or ME machine to install it on.

2) Plug the smart card reader into the USB port on your Windows box. It
   should recognize it and ask to install the drivers that already exist
   on the machine.

3) If you plan on using the Netscape browser, select the Schlumberger Smart
   Cards and Terminals -> PKCS11 Enable -> Enable PKCS11 for Netscape
   from the Start menu. This should install the PKCS11 module into
   your Netscape browser. If it doesn't work, you will need to do it manually:

    Version 4.x
    -----------
    A) Open the Netscape browser.
    B) Click on the "Security" lock icon at the top of the window. 
    C) Select "Cryptographic Modules"
    D) Select "Add"
    E) Enter a name like "Smart Card" into the "Module Name" field.
    F) Enter the location of slbck.dll into the "Module File" field. It is
       located at D:\Program Files\Schlumberger\Smart Cards and Terminals\
                  Cyberflex Access Kits\v4 on my computer
    G) Select Ok.

    Version 6+
    ----------
    A) Open the Netscape browser.
    B) Select Edit->Preferences->Privacy and Security->Certificates
    C) Click on "Manage Security Devices"
    D) Select "Load"
    E) Enter a name like "Smart Card" into the "Module Name" field.
    F) Browse and find the "slbck.dll" into the "Module File" field. It is
       located at D:\Program Files\Schlumberger\Smart Cards and Terminals\
                  Cyberflex Access Kits\v4 on my computer
    G) Select Ok.

4) Insert a card into the card reader.

5) Start the COVE Admin tool from the start button by traversing
   Schlumber Smart Cards and Terminals->Cyberflex Access SDK 4.2->
   COVE Admin Tool 4.2

6) Select the "Schlumberger Reflex USB" and then click "Connect" to
   connect to the card.

7) Choose the cryptography support:

   o If you will be using only Microsoft IE, select "Microsoft.cpf"
   o If you will be using only Netscape, select "Netscape.cpf"
   o If you will be using both Netscape and IE, select 
     "Microsoft_interop_Netscape.cpf"

8) Personalize the card: Modify the card label the User PIN. You may make
   the PIN things any alphanumeric (policy can be modified in the
   advanced section)

9) Click on "Select Keys..." and open COVE.ksf and then choose
   "Cyberflex Access Developer 32K"

10) Click on "Personalize" and the card is now ready to load a certificate.

11) Go to the CA using your browser. Select "Request Browser Certificate."

12) Enter the user id for the user to be granted access. This is the
    same user id given when you created the user in the User Admin.
    If you are using Netscape, select "1024" for the key size. If you
    are using IE, select "Schlumberger Cryptographic Service Provider"
    for the cryptographic service provider. Select "Get Certificate."

13) If you set up your CA so that it doesn't require manual input,
    the certificate will be installed into your smart card (requiring
    the PIN you gave in step 12). If you require a manual approval of
    the certificate, you must first approve the certificate, then view
    the certificate and click on "Install Certificate" to download it
    into your browser*. 

    * Note that the user can also install a CA certificate this way also and
      they will never be prompted with that annoying "invalid certificate"
      error.

14) Connect to the SSL port of your Cougaar service. You should be able to
    select the new certificate (or it may be done for you automatically) and
    it will recognize you as the user in the smart card.


SMART CARD KEYSTORE PASSWORD APPLET
===================================

1) Compile and install the smart card libraries and software:

    cd securityservices/test/configs/smartcard
    tar xzf pcsc-lite-1.1.1.tar.gz
    tar xzf slb_rfUSB-drv-0.9.0.tar.gz
    tar xzf jpcsc.tar.gz

    cd pcsc-lite-1.1.1
    ./configure
    make
    sudo make install
    cd ../slb_rfUSB
    make
    sudo mkdir -p /usr/local/pcsc/drivers/
    sudo make install
    cd ../jpcsc
    make
    sudo cp libjpcsc.so /usr/local/lib
    
2) If you want to compile the applet, you must install java 1.3.1.
   If you do not want to compile the applet, skip to step #6.

3) Copy the contents from the Schlumberger's CAPmaker/ directory, point
   your classpath to include the .jars and export files:

   mv "$CAPmaker/Export Files" $CAPmaker/Export_Files"
   setenv CLASSPATH `echo $CAPmaker/*.jar $CAPmaker/Export_Files | \
                     sed -e 's/ /:/g'`
   
4) Compile the PasswordApplet.

   javac -d . PasswordApplet.java

5) Create the .cap file from the .class file:
   
   java com.sun.javacard.converter.Converter -exportpath \
     "$CAPmaker/Export_Files" -out CAP -d . \
     -applet 0x00:0x01:0x02:0x03:0x04:0x05 PasswordApplet \
     org.cougaar.javacard.demo 0x01:0x02:0x03:0x04:0x05 1.0

   java com.slb.javacard.jctools.Cap.makecap \
     org/cougaar/javacard/demo/javacard/demo.cap

6) Use the Schlumberger's toolkit software to install the new demo.cap file.
   The AID is 0102030405

7) Create an application instance. Use the applet id 000102030405 and
   size of 800 bytes.

8) Plug the USB card reader into your Linux server.

9) Restart the pcscd daemon:

   killall -9 pcscd
   rm -rf /usr/pcsc
   /usr/local/sbin/pcscd

   If you want to see the communication between to and from the card, add
   a parameter '-d stdout' to the pcscd command line.

10) Modify the cryptoPolicy.xml file to tell the server to use the smart card
    for the keystore password. Add the following line under the
    "cryptoClientPolicy."

    <keystoreUseSmartCard/>

11) The keystore password is created and stored into the smart card
    automatically. Therefore, you must not have a keystore before 
    starting the server. In otherwords, delete any keystore for this
    node. Then start the server as usual.
