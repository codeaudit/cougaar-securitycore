#!/bin/tcsh -f

set USER=srosset

# ############
# Copys security services Servlet classes removes tomcat log and restarts tomcat

#######################################################

# Provide COUGAAR_install path if one is not defined

setenv COUGAAR_INSTALL_PATH /home/u/${USER}/UL/cougaar-8.6.1pre3

###################################################

# Provide COUGAARCLASSES path if one is not defined

setenv COUGAARCLASSES /home/u/${USER}/UL/securityservices/classes

###################################################


# Provide COUGAAR_SECURITY_SERVICES  if one is not defined

setenv  COUGAAR_SECURITY_SERVICES /home/u/${USER}/UL/securityservices

#####################################################

###################################################

# Provide TOMCAT_HOME  if one is not defined

setenv  TOMCAT_HOME /var/tomcat4/

#####################################################


setenv JAVA_HOME /usr/java/jdk1.3.1

#####################################################
# Application subdirectory (below $TOMCAT_HOME/webapps)
setenv APP_HOME CA

#####################################################
# Do not modify anything below

echo $COUGAAR_INSTALL_PATH
echo $COUGAAR_SECURITY_SERVICES
echo $COUGAARCLASSES
echo $TOMCAT_HOME

setenv PATH ${PATH}:${JAVA_HOME}/bin

if(! $?COUGAAR_INSTALL_PATH) then
   echo provide cougaar install path
endif

if(! $?COUGAAR_SECURITY_SERVICES) then
  echo provide cougaar SECURITY_SERVICES path
endif

if(! $?COUGAARCLASSES) then
echo provide cougaar COUGAARCLASSES path
endif

if(! $?TOMCAT_HOME) then
echo provide path to TOMCAT_HOME
endif

echo everything required is there



cd $COUGAAR_SECURITY_SERVICES/test/configs/servlet/
tar -cvf $TOMCAT_HOME/webapps/servlet.tar --exclude=CVS CA

# stop tomcat server
/etc/rc.d/init.d/tomcat4 stop
wait
sleep 5
# delete log files
rm -rf $TOMCAT_HOME/logs/*

cp $COUGAAR_SECURITY_SERVICES/sys/*.jar $TOMCAT_HOME/webapps/${APP_HOME}/WEB-INF/lib/
cp $COUGAARCLASSES/securityservices.jar $TOMCAT_HOME/webapps/${APP_HOME}/WEB-INF/lib/
cd  $TOMCAT_HOME/webapps/${APP_HOME}/WEB-INF/classes

jar -xvf $TOMCAT_HOME/webapps/${APP_HOME}/WEB-INF/lib/securityservices.jar \
        com/nai/security/certauthority/CertificateSigningRequest.class \
        com/nai/security/certauthority/CertificateList.class \
        com/nai/security/certauthority/CertificateDetailsServlet.class \
        com/nai/security/certauthority/RevokeCertificateServlet.class

cd  $TOMCAT_HOME/webapps/
tar -xvf servlet.tar


#start tomcat
/etc/rc.d/init.d/tomcat4 start

wait
sleep 4
