#!/usr/bin/ruby
####################################################
# enclave_crl_providers.rule

if ! defined? CIP
  CIP = ENV['COUGAAR_INSTALL_PATH']
end
$:.unshift File.join(CIP, 'csmart', 'assessment', 'lib')

require 'security/lib/common_security_rules'

society.each_node do |node|
  agentname = ""
  node.each_facet(:role) do |facet|
    if facet[:role] == $facetManagement
       enclave = node.host.get_facet(:enclave)
       agentname = enclave[0..0] + enclave[1..enclave.length].downcase + "EnclaveCrlManager"
       node.add_agent(agentname) do |agent|
         agent.add_component do |c|
           c.classname = "org.cougaar.core.security.crypto.crl.servlet.CRLRegistrationInfo"
           c.add_argument("/CRLRegistrationViewer")
         end
         agent.add_component do |c|
           c.classname = "org.cougaar.core.security.crypto.crl.plugin.CrlAgentRegistrationPlugin"
           c.add_argument("60")
         end
       end
    end
  end
end
