<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1252">
<META NAME="Generator" CONTENT="Microsoft Word 97">
<TITLE>Certificate Authority HOW-TO</TITLE>
<META NAME="Template" CONTENT="C:\Program Files\Microsoft Office\Office\html.dot">
</HEAD>
<BODY LINK="#0000ff" VLINK="#800080">

<FONT FACE="Courier New" SIZE=2><P>Certificate Authority HOW-TO</P>
<P>============================</P>
<P>This guide describes how to install and configure a simple Certificate</P>
<P>Authority (CA) server for the Cougaar system. The CA provides the following</P>
<P>services:</P>
<P>* Support for multiple Certificate Authorities. Each CA has its own key.</P>
<P>* Web interface to send a certificate signing request (PKCS10 format) to </P>
<P>a certificate authority. The certificate authority is specified by its</P>
<P>distinguished name.</P>
<P>* Web interface to send a signed X.509 certificate.</P>
<P>* Web interface to view issued certificates.</P>
<P>* Web interface to revoke a certificate.</P>
<P>* Web interface to view pending certificate signing requests.</P>
<P>These services are used by Cougaar nodes to generate key pairs</P>
<P>and send certificate requests to a Certificate Authority.</P>
<P>The certificate authority runs as a Cougaar node.</P>
<P>Note:</P>
<P>This certification authority is not intended to replace a COTS or GOTS CA.</P>
<P>In particular, it does not attempt to address all the security issues associated</P>
<P>with a Certificate Authority. The immediate goal of this service is to greatly</P>
<P>facilitate software tests in the Ultra*Log program by allowing to easily install</P>
<P>a Cougaar society without having to manually create certificates and sign them with a COTS or GOTS Certificate Authority.</P>
<P>&nbsp;</P>
<P>Pre-requisite before configuring the CA</P>
<P>========================================</P>
<P>1. Install Cougaar</P>
<P>2. Install NAI's security services module by typing ant install in the top-level directory.</P>
<P>Install and configure the CA</P>
<P>============================</P>
<P>1. The CA requires a set of security components and servlets. Two sample ".ini" files are provided in the test/configs/cougaarCA directory.</P>
<P>2. The CA runs as one Cougaar node with one agent.</P>
<P>The caNode.ini file is the Certificate Authority node's ini file.</P>
<P>The caAgent.ini file is the Certifificate Authority agent's ini file.</P>
<P>3. The content of these ini files should not be changed. As other agents in the society, each CA should have a unique name, therefore each node and agent ini file should be unique in the society.</P>
<P>If you need only one CA, you can keep the existing caAgent.ini and caNode.ini files.</P>
<P>If you need more than one CA, you will need to copy those files and give names of your choice.</P>
<P>4. Each CA should have its own naming service. In particular, the CA should not register itself with the society's naming service. This can be achieved by creating an alpreg.ini file with the following content and installing every CA on its own machine:</P>
<P>[ Registry ]</P>
<P>address=localhost</P>
<P>alias=AlpFDS</P>
<P>port=8010</P>
<P>5. The cougaarCA directory contains two files that are required by the CA.</P>
<P>The "caPolicyTemplate.xml" is a template file which is used by the CA whenever a new CA key is generated.</P>
<P>The cryptoPolicy.xml is a policy file which is used to issue certificates.</P>
<P>Every CA should have these two files in their startup directory.</P>
<P>6. The cryptoPolicy.xml file contains a &lt;isRootCA&gt; tag which specifies whether the CA is a root CA or not.</P>
<P>For example, assume the following CA deployment:</P>
<P>CA1</P>
<P>|</P>
<P>/ \</P>
<P>CA2 CA3</P>
<P>CA1 is the root CA and has a self-signed certificate. CA2 and CA3 have their certificates signed by CA1. The isRootCA value should be true for CA1 and false for CA2 and CA3.</P>
<P>The cryptoPolicy.xml file must include the URL of the root CA.</P>
<P>Example for a subordinate CA policy, the trustedCA specifies which CA this CA's keys should sent to to be signed.</P>
<P>&lt;trustedCA&gt;</P>
<P>&lt;CA_alias&gt;NCA_CA&lt;/CA_alias&gt;</P>
<P>&lt;CA_DN&gt;CN=NCA_CA, OU=CONUS, O=DLA, L=San Francisco, ST=CA, C=US, T=ca&lt;/CA_DN&gt;</P>
<P>&lt;CA_URL role="rliao1"&gt;http://yew:5556/$caAgent/CA/CertificateSigningRequest&lt;/CA_URL&gt;</P>
<P>&lt;CertDirectoryURL role="rliao1"&gt;ldap://yew:389/dc=rliao1,dc=cougaar,dc=org&lt;/CertDirectoryURL&gt;</P>
<P>&lt;CertDirectoryType&gt;CougaarOpenLdap&lt;/CertDirectoryType&gt;</P>
<P>&lt;/trustedCA&gt;</P>
<P>The trustedCA tag is commented out in the default cryptoPolicy.xml because the default CA is root CA.</P>
<P>7. You may also configure the following parameters in the cryptoPolicy.xml file:</P>
<P>ou: the organizational unit in which the CA is running</P>
<P>o: the organization in which the CA is running</P>
<P>l: the locality in which the CA is running</P>
<P>st: the state in which the CA is running</P>
<P>c: the country in which the CA is running</P>
<P>validity: the validity of the CA.</P>
<P>8. It is suggested to create one directory for each CA. Each directory should contain the appropriate .ini, cryptoPolicy.xml and caPolicyTemplate.xml files.</P>
<P>Install and configure the user database policy</P>
<P>==============================================</P>
<P>User access control is enforced for each CA operation. The CA should be configured to</P>
<P>request appropriate user credentials before a critical operation has to be performed.</P>
<P>The following operations should be performed by a CA administrator only:</P>
<P>* Issuing certificates</P>
<P>* Revoking certificates</P>
<P>* Submitting a CA key to an upper-level CA</P>
<P>* Processing pending certificate signing requests.</P>
<P>* Creating a CA key.</P>
<P>Other operations (such as viewing the list of certificates) may be performed by</P>
<P>any other operator.</P>
<P>The "BootPolicy.Servlet.xml" in the test/configs/common directory provides a default</P>
<P>policy for the CA. Only the "CAAdministrator" role has access to the critical operations,</P>
<P>and anybody else can have access to the list of certificates.</P>
<P>The LDAP user database should be configured with at least the "CAAdministrator" role and</P>
<P>one user with the "CAAdministrator" role.</P>
<P>The "BootPolicy.UserDB.xml" policy file describes the configuration of the LDAP user</P>
<P>database. The file should be customized to your own environment. In particular,</P>
<P>the URL of the LDAP directory service must be edited.</P>
<P>A "BootPolicy.UserDB.TIC.xml" file should have the appropriate values for the TIC. Rename</P>
<P>the file to BootPolicy.UserDB.xml.</P>
<P>Refer to the test/doc/README.userdb file for more information on how to install</P>
<P>the user LDAP database, and how to install and configure the user management agent.</P>
<P>The CA access control policy must be configured in two phases:</P>
<P>1) Initially, the CA should be installed and configured with both HTTP and HTTPS</P>
<P>enabled. The CA administrator will configure the CA by using HTTP.</P>
<P>This involves creating a CA key, as well as the CA agent, node and host keys.</P>
<P>Since HTTP is not secure, this first step of the installation should be done</P>
<P>without connecting the CA to the network, at least when the CA is intended to</P>
<P>be used in a production environment.</P>
<P>2) Once the CA, agent, node and host keys have been created, HTTP should be disabled.</P>
<P>CA operations should be done by using HTTPS only.</P>
<P>Start the CA and create a CA key</P>
<P>================================</P>
<P>1. Go to the CA startup directory.</P>
<P>2. Start the CA by typing:</P>
<P>SecureNode node</P>
<P>where node is the CA node .ini file.</P>
<P>3. Once the CA is started, a CA key should be generated.</P>
<P>Open a browser, and go to the CA node main URL. For instance:</P>
<P>http://hostname:5570/</P>
<P>Follow the following links:</P>
<P>* List local agents</P>
<P>* caAgent (or the name of the CA agent)</P>
<P>* /$caAgent/CA/Index</P>
<P>You should get two frames with the left frame providing a list of operations.</P>
<P>4. Follow the "Create CA key" link to create a CA key/. Note that you should have to</P>
<P>enter the appropriate user name and password. You should enter the name and password</P>
<P>of a user with the CAAdministrator role.</P>
<P>5. Enter the appropriate information in the form, then click "submit"</P>
<P>6. The CA must currently be shutdown then restarted before the CA can be used to</P>
<P>issue certificates for other agents.</P>
<P>Kill the CA agent, then edit the "BootPolicy.Servlet.xml" file to require SSL</P>
<P>for the administrative operations.</P>
<P>&lt;rule requireSSL="true"&gt;</P>
<P>&lt;!-- only let the administrator do write-only stuff --&gt;</P>
<P>&lt;pattern&gt;/CA/RevokeCertificateServlet&lt;/pattern&gt;</P>
<P>&lt;pattern&gt;/CA/CreateCaKeyServlet&lt;/pattern&gt;</P>
<P>&lt;pattern&gt;/CA/SubmitCaKeyServlet&lt;/pattern&gt;</P>
<P>&lt;pattern&gt;/CA/ProcessPendingCertServlet&lt;/pattern&gt;</P>
<P>&lt;pattern&gt;/CA/CaKeyManagement&lt;/pattern&gt;</P>
<P>&lt;role&gt;CAAdministrator&lt;/role&gt;</P>
<P>&lt;/rule&gt;</P>
<P>You may also require HTTPS for other operations if you wish. This can be done</P>
<P>by setting the requireSSL attribute for the other non-administrative operations.</P>
<P>requireSSL="true"</P>
<P>7. HTTP may also be turned off, if you want to completely disable HTTP. This is done by adding the following property in your Linux.props file:</P>
<P># You can also turn on/off http/s. Turn of by setting the port to -1</P>
<P># Note that HTTPS is off by default, and HTTP is at 8800</P>
<P>org.cougaar.lib.web.https.port=-1</P>
<P>8. Restart the CA.</P>
<P>Once the CA has finished its initialization sequence, you should have the following files in the $COUGAAR_WORKSPACE/security/keystores/caNode directory:</P>
<P>(where caNode is the name of the CA node, which can vary.</P>
<P>keystore-caNode : the keystore containing the private keys of the CA.</P>
<P>keystore-CONUS-RSA : the keystore containing the public keys of the CA.</P>
<P>serialNumber.txt : a file containing the next serial number when issuing</P>
<P>certificates.</P>
<P>cryptoPolicy.xml : the crypto policy file of the CA.</P>
<P>&nbsp;</P>
<P>9. All the (non root CA) nodes should be configured to trust at least one CA.</P>
<P>For instance, if you have configured a root CA, then you can choose to export the CA key from the keystore-CONUS-RSA file, then import it to the node trusted CA keystore file.</P>
<P>10. When creating a subordinate CA key:</P>
<P>The upper level CA certificate should be imported into subordinate CA trust store. This can be done after starting the subordinate CA and then shutting it down, so that the directory structures including the trust store are created.</P>
<P>A certificate signing request is sent to the upper level CA automatically after the subordinate key has been generated, so you don't need to click on "submit CA key".</P>
<P>The "Submit CA key to superior" and "list subordinate CA keys" links are currently not available. Currently when a subordinate CA certificate request to upper level CA is pending or for any reason does not receive a certificate reply the request will be sent again when the CA restarts. In the future the <BR>
"Submit CA key to superior" link will list all CA keys that have been generated but have not yet been approved by upper level CA.</P></FONT></BODY>
</HTML>
