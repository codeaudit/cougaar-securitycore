/* 
 * <copyright> 
 *  Copyright 1999-2004 Cougaar Software, Inc.
 *  under sponsorship of the Defense Advanced Research Projects 
 *  Agency (DARPA). 
 *  
 *  You can redistribute this software and/or modify it under the
 *  terms of the Cougaar Open Source License as published on the
 *  Cougaar Open Source Website (www.cougaar.org).  
 *  
 *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 *  "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 *  LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 *  A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 *  OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 *  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 *  LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 *  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 *  THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 *  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 *  OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *  
 * </copyright> 
 */ 



/**
 *
 * @author  rtripath
 * @version 
 */
package org.cougaar.core.security.crypto;

import java.awt.Dimension;
import java.util.Vector;

import javax.swing.JFrame;

import org.cougaar.core.component.ServiceRevokedEvent;
import org.cougaar.core.component.ServiceRevokedListener;
import org.cougaar.core.plugin.ComponentPlugin;
import org.cougaar.core.security.services.crypto.CRLCacheService;
import org.cougaar.core.security.services.crypto.KeyRingService;

public class CRLGUIPlugin
  extends ComponentPlugin
{
  static JFrame frame;

  // Variables declaration - 
  private javax.swing.JPanel jListPanel;
  private javax.swing.JList jCrlList;
  private javax.swing.JButton jCrlButton;
  private javax.swing.JPanel jTimerPanel;
  private javax.swing.JTextField jTimerTextField;
  private javax.swing.JButton jTimerButton;
  private javax.swing.JComboBox jTimerComboBox;
  private javax.swing.JLabel jTimerLabel;
  private String units=new String("Seconds");

  private CRLCacheService crlCacheService=null;
  private KeyRingService keyRing = null;

  public CRLGUIPlugin()
  {
    // Get KeyRingService
    keyRing = (KeyRingService)
      getServiceBroker().getService(
	this,
	KeyRingService.class, 
	new ServiceRevokedListener() {
	    public void serviceRevoked(ServiceRevokedEvent re) {
	      if (KeyRingService.class.equals(re.getService()))
		keyRing  = null;
	    }
	  });
     crlCacheService = (CRLCacheService)
      getServiceBroker().getService(
	this,
	CRLCacheService.class, 
	new ServiceRevokedListener() {
	    public void serviceRevoked(ServiceRevokedEvent re) {
	      if (CRLCacheService.class.equals(re.getService()))
		crlCacheService = null;
	    }
	  });
  }

  /** This method is called from within the constructor to
   * initialize the form.
   * WARNING: Do NOT modify this code. The content of this method is
   * always regenerated by the FormEditor.
   */
  private void initGuiComponents() 
  {
    frame =new JFrame(getGUITitle());
    frame.setLocation(0,0);


    //  Creates the complete gui
    String [] timedef={"Hours","Minutes","Seconds"};

    jListPanel = new javax.swing.JPanel();
    jCrlList = new javax.swing.JList();
    jCrlButton = new javax.swing.JButton();
    jTimerPanel = new javax.swing.JPanel();
    jTimerTextField = new javax.swing.JTextField();
    jTimerButton = new javax.swing.JButton();
    jTimerComboBox = new javax.swing.JComboBox(timedef);
    jTimerComboBox.setSelectedIndex(jTimerComboBox.getItemCount()-1);
    jTimerLabel = new javax.swing.JLabel();
    frame.getContentPane().setLayout(null);
        
    frame.addWindowListener(new java.awt.event.WindowAdapter(){
	public void windowClosing(java.awt.event.WindowEvent evt) 
	{
	  exitWindow(evt);
	}
      });
        
    jListPanel.setLayout(null);
    jListPanel.setPreferredSize(new Dimension(120,150));
    jListPanel.setMinimumSize(new Dimension(120,150));
    jListPanel.setBounds(0,0,120,150);
    jListPanel.add(jCrlList);
    jCrlList.setBounds(10,5, 110,100);
          
          
    jCrlButton.setName("JgetcrlButton");
    jCrlButton.setText("Get Crl List");
    jCrlButton.addMouseListener(new java.awt.event.MouseAdapter() {
	public void mouseClicked(java.awt.event.MouseEvent evt) 
	{
	  jCrlButtonMouseClicked(evt);
	}
      });
    jListPanel.add(jCrlButton);
    jCrlButton.setBounds(10, 110, 100, 22);
          
    Vector empty=new Vector();
    empty.addElement("Empty"); 
    jCrlList.setListData(empty);
    frame.getContentPane().add(jListPanel);
        
    jTimerPanel.setLayout(null);
    jTimerPanel.setPreferredSize(new Dimension(300,150));
    jTimerPanel.setMinimumSize(new Dimension(300,150));
    jTimerPanel.setBounds(120,0,300,150);
    jTimerTextField.setText("20");
    jTimerPanel.add(jTimerTextField);
    jTimerTextField.setBounds(15, 60, 100, 22);
          
    jTimerButton.setText("Set Interval");
    jTimerButton.addMouseListener(new java.awt.event.MouseAdapter() {
	public void mouseClicked(java.awt.event.MouseEvent evt) 
	{
	  jTimerButtonMouseClicked(evt);
	}
      });
    jTimerPanel.add(jTimerButton);
    jTimerButton.setBounds(60, 100, 140, 25);
    jTimerComboBox.addActionListener(new java.awt.event.ActionListener() {
	public void actionPerformed(java.awt.event.ActionEvent evt) 
	{
	  jTimerComboBoxactionPerformed(evt);
	}
      });
    jTimerPanel.add(jTimerComboBox);
    jTimerComboBox.setBounds(125, 60, 100, 22);
          
    jTimerLabel.setText(" Set Interval Time for CRL");
    jTimerLabel.setFont(new java.awt.Font ("Dialog", 1, 14));
    jTimerPanel.add(jTimerLabel);
    jTimerLabel.setBounds(10,5, 300, 50);
    
          
    frame.getContentPane().add(jTimerPanel);
    frame.pack();
    frame.setBounds(0,0,400,170);
    frame.setVisible(true);
        
  }
  protected final void setupSubscriptions()
  {
    initGuiComponents();
  }
  public final void execute()
  {
		
  }
  protected String getGUITitle()
  {
    return "CRLGUIPlugin";
  }

  private void jTimerButtonMouseClicked(java.awt.event.MouseEvent evt) 
  {
    long sleep_time=1000L;
    int sleeptime=0;
    String texttimer=jTimerTextField.getText();
    try
      {
	sleeptime=Integer.parseInt(texttimer.trim());
      }
    catch(NumberFormatException nexp)
      {
	sleeptime=1;
	nexp.printStackTrace();
      }
    if(units.equalsIgnoreCase("seconds"))
      {
	sleep_time= sleeptime*1000L;
      }
    else if(units.equalsIgnoreCase("Minutes"))
      {
	sleep_time=sleeptime*1000L*60L;
			
      }
    else if(units.equalsIgnoreCase("Hours"))
      {
			
	sleep_time=sleeptime*1000L*60L*60L;
      }
    crlCacheService.setSleeptime(sleep_time);
  }

  private void jTimerComboBoxactionPerformed(java.awt.event.ActionEvent evt)
  {

    units=(String)jTimerComboBox.getSelectedItem();
  }

  private void jCrlButtonMouseClicked(java.awt.event.MouseEvent evt) 
  {
    //Vector crllist=keyRing.getCRL();
    // the keyRing function does not do anything and has been removed
    Vector crllist = new Vector();
    jCrlList.setListData(crllist);
  
  }

 
  /** Exit the Application */
  private void exitWindow(java.awt.event.WindowEvent evt) 
  {
  }

  public static void main(String args[])
  {
    CRLGUIPlugin crlpgin=new CRLGUIPlugin();
    crlpgin.initGuiComponents();
    frame.show();
  }
}
