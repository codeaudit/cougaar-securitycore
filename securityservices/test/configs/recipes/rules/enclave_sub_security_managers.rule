# enclave_sub_security_managers.rule


society.each_node do |node|
  agentname = ""
  enclave = ""
  # only do this for enclaves Fwd and Conus
  if node.name == "FWD-MGMT-NODE"
    enclave = "Fwd" # Enclave 2
  elsif node.name == "CONUS-MGMT-NODE" 
    enclave = "Conus" # 3
  end

  if enclave != ""
    sub = 1..2  # enclave 2 has sub1 and sub2, but enclave 3 has only sub1
    sub.each do |this_sub|
      if enclave == "Conus" and this_sub == 2
        break
      end
      agentname = enclave + "EnclaveSub" + this_sub.to_s + "Manager"
      node.add_agent(agentname) do |agent|
        agent.classname = "org.cougaar.core.agent.ClusterImpl"
        agent.add_component do |c|
          c.classname = "org.cougaar.core.security.monitoring.plugin.CapabilitiesProcessingPlugin"
        end
        agent.add_component do |c|
          c.classname = "org.cougaar.core.security.monitoring.plugin.CapabilitiesConsolidationPlugin"
        end
        agent.add_component do |c|
          c.classname = "org.cougaar.core.security.monitoring.plugin.MnRQueryReceiverPlugin"
        end
        agent.add_component do |c|
          c.classname = "org.cougaar.core.security.monitoring.plugin.MnRQueryResponderPlugin"
        end
        agent.add_component do |c|
          c.classname = "org.cougaar.core.security.monitoring.plugin.RateCalculatorPlugin"
          c.add_argument("20")
          c.add_argument("3600")
          c.add_argument("org.cougaar.core.security.monitoring.MESSAGE_FAILURE")
          c.add_argument("org.cougaar.core.security.monitoring.MESSAGE_FAILURE_RATE")
        end
        agent.add_component do |c|
          c.classname = "org.cougaar.core.adaptivity.AdaptivityEngine"
        end
        agent.add_component do |c|
          c.classname = "org.cougaar.core.adaptivity.ConditionServiceProvider"
        end
        agent.add_component do |c|
          c.classname = "org.cougaar.core.adaptivity.OperatingModeServiceProvider"
        end
        agent.add_component do |c|
          c.classname = "org.cougaar.core.adaptivity.PlaybookManager"
          c.add_argument("AMnRPlaysEnclave.txt")
        end
        agent.add_component do |c|
          c.classname = "org.cougaar.core.security.monitoring.plugin.EventQueryPlugin"
          c.add_argument(agent.name)
          c.add_argument("org.cougaar.core.security.monitoring.plugin.AllMessageFailures")
        end
        agent.add_component do |c|
          c.classname = "org.cougaar.core.security.monitoring.servlet.MnRRegistrationViewerComponent"
          c.add_argument("/monitoringRegistrationViewer")
        end
        agent.add_component do |c|
          c.classname = "org.cougaar.core.security.monitoring.servlet.MnRResponseViewerComponent"
          c.add_argument("/monitoringQueryViewer")
        end
      end
    end
  end
end

