#!/usr/bin/ruby
##########################################
# add attacker node & agent
#

added = false

def add_node(host) 
  host.add_node("NO-SSL-ATTACK-NODE") do |node|
    node.add_facet('attacker' => 'NonSSL')
    node.override_parameter('-Dorg.cougaar.lib.web.http.port', '8820');
  end
  host.add_node("AttackerNode") do |node|
    node.add_facet('attacker' => 'ok')
    node.override_parameter('-Dorg.cougaar.lib.web.http.port', '8830');
#    puts("port for attackernode = #{node.cougaar_port}")
    node.add_agent("MessageAttacker") do |agent|
      agent.add_facet('attacker' => 'message')
      # no special components on the attacker right now
#      puts("uri for MessageAttacker = #{agent.uri}")
    end
  end
end

society.each_host do |host|
  if host.has_facet? "attacker"
    add_node(host)
    added = true
    break
  end
end

if (!added) 
  # find the first non-nameserver host
  society.each_host do |host|
    facet_ok = true
    host.each_facet("service") { |facet|
      if (facet["service"] == "nameserver")
        facet_ok = false;
      end
    }
    if (facet_ok)
      host.add_facet({"attack" => "true"})
      add_node(host)
      added = true
      break
    end
  end
end

if (!added) 
  print "Could not add attacking node! " +
    "There are no hosts with facet 'attacker' " +
    "and there are no non-nameserver hosts\n"
end
