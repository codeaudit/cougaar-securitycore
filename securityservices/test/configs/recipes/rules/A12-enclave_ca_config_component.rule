####################################################
# enclave_ca_config_component.rule

cahost = nil
society.each_node do |node|
  if node.name == 'ROOT-CA-NODE'
    cahost = node.host.name 
  end
end

if cahost != nil
  society.each_node do |node|
    enclave = nil
    if node.name == 'REAR-CA-NODE'
      enclave = "Rear"
    elsif node.name == 'FWD-CA-NODE'
      enclave = "Fwd"
    elsif node.name == 'CONUS-CA-NODE'
      enclave = "Conus"
    elsif node.name == 'TRANS-CA-NODE'
      enclave = "Trans"
    end
    if enclave != nil
      arg = 'CN=' + enclave + 'EnclaveCA, OU=' + enclave + 'Enclave' \
            ', O=DLA, L=MV, ST=CA, C=US, T=ca'
      node.agent.add_component do |c|
        c.name = enclave + "EnclaveCaConfigPlugin"
        c.classname = "org.cougaar.core.security.certauthority.ConfigPlugin"
        c.priority = "HIGH"
        c.insertionpoint = "Node.AgentManager.Agent.SecurityComponent"
        c.add_argument(arg)
        c.add_argument("")
        c.add_argument(cahost + ":RootCaManager:8800:9800")
      end
    end
  end
end
